<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BeagleY-AI + Thistle OTA Updates - Professional Codelab</title>

  <!-- Reveal.js Core -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.css">
  <link rel="stylesheet" href="../../framework/thistle-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
</head>

<body>
  <div class="reveal">
    <div class="slides">

      <!-- Title Slide -->
      <section class="title-slide">
        <h1>BeagleY-AI + Thistle OTA</h1>
        <p class="subtitle">Professional Over-The-Air Updates Workshop</p>

        <div class="logos">
          <span class="logo">BeagleBoard.org</span>
          <span class="logo">Thistle Technologies</span>
        </div>

        <div class="alert alert-info" style="max-width: 700px; margin: 2rem auto;">
          <strong>Learning Objective:</strong> Deploy cryptographically signed software updates wirelessly to embedded Linux hardware using modern security practices and professional tools.
        </div>

        <p style="margin-top: 2rem; font-size: 1rem; color: var(--text-muted);">
          <strong>Resources:</strong> <a href="https://docs.thistle.tech" target="_blank">docs.thistle.tech</a> ‚Ä¢ <a href="https://docs.beagleboard.org" target="_blank">docs.beagleboard.org</a><br>
          <strong>Duration:</strong> 90 minutes ‚Ä¢ <strong>Level:</strong> Beginner to Intermediate
        </p>
      </section>

      <!-- Learning Outcomes -->
      <section>
        <h2>Learning Outcomes</h2>
        <p class="lead">By the end of this workshop, you will:</p>

        <div class="grid grid-2">
          <div class="card">
            <h3><span class="icon icon-security"></span>Security Implementation</h3>
            <ul>
              <li>Understand cryptographic signing for updates</li>
              <li>Implement device authentication</li>
              <li>Configure secure update verification</li>
            </ul>
          </div>
          <div class="card">
            <h3><span class="icon icon-hardware"></span>Hardware Integration</h3>
            <ul>
              <li>Flash and configure BeagleY-AI</li>
              <li>Establish reliable network connectivity</li>
              <li>Control GPIO hardware via OTA</li>
            </ul>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <h3><span class="icon icon-code"></span>Development Workflow</h3>
            <ul>
              <li>Package and sign software releases</li>
              <li>Deploy updates via cloud infrastructure</li>
              <li>Verify successful installation</li>
            </ul>
          </div>
          <div class="card">
            <h3><span class="icon icon-check"></span>Production Readiness</h3>
            <ul>
              <li>Understand rollback mechanisms</li>
              <li>Implement CI/CD integration patterns</li>
              <li>Scale to fleet management</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Why OTA Updates Matter -->
      <section>
        <section>
          <h2>Why OTA Updates Matter</h2>
          <p class="lead">The critical importance of secure device management</p>

          <div class="grid grid-3">
            <div class="card">
              <h3>The Problem</h3>
              <p>Unpatched firmware causes 60% of IoT security breaches</p>
              <span class="badge badge-error">Critical Risk</span>
            </div>
            <div class="card">
              <h3>The Impact</h3>
              <p>IoT security failures cost businesses an average of $330,000 per incident</p>
              <span class="badge badge-warning">Business Cost</span>
            </div>
            <div class="card">
              <h3>The Solution</h3>
              <p>Automated, secure OTA updates like modern smartphones</p>
              <span class="badge badge-success">Modern Standard</span>
            </div>
          </div>
        </section>

        <section>
          <h3>Industry Statistics</h3>
          <div class="grid grid-2">
            <div class="card">
              <h4>Security Vulnerabilities</h4>
              <ul>
                <li>50%+ of IoT devices have critical vulnerabilities</li>
                <li>1 in 3 data breaches involves an IoT device</li>
                <li>10 attacks per day on average home network</li>
              </ul>
            </div>
            <div class="card">
              <h4>Update Success Rates</h4>
              <ul>
                <li>Mobile OTA updates: 95-99% success rate</li>
                <li>Automation reduces errors by 72%</li>
                <li>Delta updates: 90-99% size reduction</li>
              </ul>
            </div>
          </div>
        </section>
      </section>

      <!-- File Update vs Secure Boot -->
      <section>
        <section>
          <h2>Update Strategies Comparison</h2>
          <p class="lead">Understanding your options for secure updates</p>

          <div class="grid grid-2">
            <div class="card">
              <h3>File Updates <span class="status status-recommended">Today's Focus</span></h3>
              <h4>What It Does</h4>
              <ul>
                <li>Updates specific files and scripts</li>
                <li>Preserves existing system state</li>
                <li>Fast deployment and rollback</li>
              </ul>
              <h4>Security Features</h4>
              <ul>
                <li>Cryptographically signed manifests</li>
                <li>Atomic file operations</li>
                <li>Verification before installation</li>
              </ul>
            </div>

            <div class="card">
              <h3>Secure Boot OTA <span class="status status-optional">Advanced</span></h3>
              <h4>What It Does</h4>
              <ul>
                <li>Complete system image updates</li>
                <li>A/B partition switching</li>
                <li>Full rollback capability</li>
              </ul>
              <h4>Security Features</h4>
              <ul>
                <li>Hardware-verified boot chain</li>
                <li>Tamper-resistant storage</li>
                <li>Zero-trust architecture</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <h3>Security Model Comparison</h3>
          <div class="alert alert-info">
            <strong>Key Insight:</strong> Both methods use the same core security principles - cryptographic signing, verification, and atomic operations. Secure Boot extends the trust chain deeper into the hardware.
          </div>

          <div class="grid grid-2">
            <div class="card">
              <h4>File Update Security Chain</h4>
              <div class="steps">
                <div class="step">Developer signs manifest with private key</div>
                <div class="step">Device downloads and verifies signature</div>
                <div class="step">Files installed atomically</div>
                <div class="step">Rollback on failure</div>
              </div>
            </div>
            <div class="card">
              <h4>Secure Boot Security Chain</h4>
              <div class="steps">
                <div class="step">Hardware verifies bootloader signature</div>
                <div class="step">Bootloader verifies kernel signature</div>
                <div class="step">Kernel verifies application signatures</div>
                <div class="step">Full system rollback on failure</div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- Prerequisites -->
      <section>
        <section>
          <h2>Prerequisites</h2>
          <p class="lead">Required hardware, software, and accounts</p>

          <div class="grid grid-2">
            <div class="card">
              <h3><span class="icon icon-hardware"></span>Required Hardware</h3>
              <div class="steps">
                <div class="step">BeagleY-AI single board computer</div>
                <div class="step">32GB+ microSD card (Class 10 or better)</div>
                <div class="step">USB-C cable with data capability</div>
                <div class="step">Host computer with internet access</div>
              </div>
            </div>

            <div class="card">
              <h3><span class="icon icon-hardware"></span>Optional Hardware</h3>
              <div class="steps">
                <div class="step">LED (any color, 3mm or 5mm)</div>
                <div class="step">Current limiting resistor (220Œ© - 2.2kŒ©)</div>
                <div class="step">Breadboard and jumper wires</div>
                <div class="step">Ethernet cable (for stable connectivity)</div>
              </div>
            </div>
          </div>
        </section>

        <section>
          <h3>Software and Account Setup</h3>

          <div class="card">
            <h4><span class="icon icon-network"></span>Thistle Account Setup <span class="status status-required">Required</span></h4>
            <div class="steps">
              <div class="step">Visit <strong><a href="https://app.thistle.tech" target="_blank">app.thistle.tech</a></strong> and create free account</div>
              <div class="step">Create new project for this workshop</div>
              <div class="step">Generate and copy Project Access Token</div>
              <div class="step">Keep token secure - treat like a password</div>
            </div>
          </div>

          <div class="card">
            <h4><span class="icon icon-code"></span>Software Requirements</h4>
            <ul>
              <li><strong>bb-imager v1.0.0+</strong> - BeagleBoard imaging utility</li>
              <li><strong>SSH client</strong> - Built into macOS/Linux, PuTTY for Windows</li>
              <li><strong>Terminal/Command Line</strong> - For running update tools</li>
              <li><strong>Text Editor</strong> - For reviewing configurations</li>
            </ul>
          </div>
        </section>
      </section>

      <!-- Step 1: Flash BeagleY-AI -->
      <section>
        <section>
          <h2>Step 1: Flash BeagleY-AI</h2>
          <p class="lead">Create bootable SD card with headless configuration</p>

          <div class="alert alert-info">
            <strong>Objective:</strong> Flash the BeagleY-AI with a Debian-based image and pre-configure SSH access for headless operation.
          </div>

          <div class="card">
            <h3>Download BeagleBoard Imager</h3>
            <p>Download from <strong><a href="https://beagleboard.org/distros" target="_blank">beagleboard.org/distros</a></strong></p>
            <ul>
              <li><strong>Windows:</strong> .exe installer</li>
              <li><strong>macOS:</strong> .dmg package</li>
              <li><strong>Linux:</strong> .AppImage executable</li>
            </ul>
          </div>
        </section>

        <section>
          <h3>Imaging Process</h3>

          <div class="grid grid-2">
            <div class="card">
              <h4>Device Selection</h4>
              <div class="steps">
                <div class="step">Launch bb-imager application</div>
                <div class="step">Choose Device: <strong>BeagleY-AI</strong></div>
                <div class="step">Choose OS: <strong>Debian 12 XFCE</strong></div>
                <div class="step">Select your microSD card as storage</div>
              </div>
            </div>

            <div class="card">
              <h4>OS Customization <span class="status status-required">Critical</span></h4>
              <div class="steps">
                <div class="step">Click Settings gear icon</div>
                <div class="step">Enable SSH with password authentication</div>
                <div class="step">Set username: <code>debian</code></div>
                <div class="step">Set strong password</div>
                <div class="step">Set hostname: <code>beagley-ota</code></div>
                <div class="step">Configure WiFi SSID/password (optional)</div>
                <div class="step">Add SSH public key (optional - recommended)</div>
              </div>
            </div>
          </div>
        </section>

        <section class="compact">
          <h3>SSH Key Setup <span class="status status-optional">Recommended</span></h3>

          <div class="alert alert-info compact">
            <strong>Why SSH Keys?</strong> SSH key authentication is more secure than passwords and enables seamless automation for file transfers and remote commands.
          </div>

          <div class="grid grid-2">
            <div class="card compact">
              <h4>Generate SSH Key (if needed)</h4>
              <pre><code class="language-bash"># Generate new SSH key pair
ssh-keygen -t ed25519 -C "beagley-workshop"

# Use default location ~/.ssh/id_ed25519
# Set passphrase or press Enter for none</code></pre>
            </div>

            <div class="card compact">
              <h4>Copy Public Key</h4>
              <pre><code class="language-bash"># Display public key for copying (ed25519 - recommended)
cat ~/.ssh/id_ed25519.pub

# Or if you have an existing RSA key
cat ~/.ssh/id_rsa.pub

# macOS: Copy to clipboard
pbcopy < ~/.ssh/id_ed25519.pub

# Linux: Copy to clipboard (if xclip installed)
xclip -selection clipboard < ~/.ssh/id_ed25519.pub</code></pre>
            </div>
          </div>

          <div class="card compact">
            <h4>Add to bb-imager Configuration</h4>
            <div class="steps compact">
              <div class="step">In bb-imager, click Settings/Customization tab</div>
              <div class="step">Find "SSH authorization public key" field</div>
              <div class="step">Paste complete public key (starts with <code>ssh-ed25519</code> or <code>ssh-rsa</code>)</div>
              <div class="step">Enable "USB DHCP" for USB networking</div>
            </div>
          </div>
        </section>

        <section>
          <h3>Write and Verify</h3>

          <div class="card">
            <h4>Flashing Process</h4>
            <p>Click <strong>Write</strong> to begin the imaging process</p>
            <ul>
              <li>Expected duration: 10-15 minutes</li>
              <li>Verification included automatically</li>
              <li>Safe removal when complete</li>
            </ul>
          </div>

          <div class="alert alert-success">
            <strong>Pro Tip:</strong> The pre-configuration eliminates manual setup steps. SSH and networking will be functional immediately after first boot.
          </div>
        </section>
      </section>

      <!-- Step 2: Connect -->
      <section>
        <section>
          <h2>Step 2: Connect to BeagleY-AI</h2>
          <p class="lead">Establish reliable SSH connection</p>

          <div class="card">
            <h3>First Boot Sequence</h3>
            <div class="steps">
              <div class="step">Insert microSD card into BeagleY-AI</div>
              <div class="step">Connect USB-C power (or to computer)</div>
              <div class="step">Wait 60-90 seconds for complete boot</div>
              <div class="step">Observe status LEDs for boot completion</div>
            </div>
          </div>
        </section>

        <section>
          <h3>Connection Methods</h3>

          <div class="grid grid-3">
            <div class="card">
              <h4>USB Networking <span class="status status-recommended">Easiest</span></h4>
              <pre><code class="language-bash"># Linux/macOS
ssh debian@192.168.7.2

# Windows
ssh debian@192.168.6.2</code></pre>
            </div>

            <div class="card">
              <h4>mDNS Resolution</h4>
              <pre><code class="language-bash">ssh debian@beagley-ota.local

# Password or SSH key (if configured)</code></pre>
            </div>

            <div class="card">
              <h4>Direct IP Address</h4>
              <pre><code class="language-bash">ssh debian@[IP-ADDRESS]

# Find IP in router interface
# or use network scanner</code></pre>
            </div>
          </div>
        </section>

        <section>
          <h3>Update System</h3>

          <div class="card">
            <h4>Update Package Repository</h4>
            <pre><code class="language-bash"># Update package lists and upgrade system
sudo apt update && sudo apt upgrade -y</code></pre>
          </div>

          <div class="alert alert-info compact">
            <strong>Note:</strong> This ensures you have the latest packages and security updates before installing tools.
          </div>
        </section>

        <section>
          <h3>Verify System</h3>

          <div class="card">
            <h4>System Verification Commands</h4>
            <pre><code class="language-bash"># Check system information
uname -a

# Verify network connectivity
ping -c 2 google.com

# Check available storage
df -h

# Verify GPIO tools
which gpioset gpiofind</code></pre>
          </div>

          <div class="alert alert-success">
            <strong>Success Criteria:</strong> All commands execute successfully, showing Linux kernel version, network connectivity, adequate storage, and GPIO utilities present. If SSH keys were configured, connection should be seamless without password prompt.
          </div>
        </section>
      </section>

      <!-- Step 3: Install Tools -->
      <section>
        <section>
          <h2>Step 3: Install Thistle Tools</h2>
          <p class="lead">Deploy TRH on workstation and TUC on device</p>

          <div class="alert alert-info">
            <strong>Architecture Note:</strong> TRH (Thistle Release Helper) runs on your development machine to package and sign updates. TUC (Thistle Update Client) runs on the BeagleY-AI to receive and apply updates.
          </div>
        </section>

        <section>
          <h3>Install TRH (Workstation)</h3>

          <div class="card">
            <h4>Download Release Helper</h4>
            <div class="steps">
              <div class="step">Visit <strong><a href="https://docs.thistle.tech/binaries" target="_blank">docs.thistle.tech/binaries</a></strong> for download links and install instructions</div>
              <div class="step">Download TRH for your platform (Linux x86_64, macOS x86_64/aarch64, Windows x86_64)</div>
              <div class="step">Extract and make executable</div>
            </div>
            <pre><code class="language-bash"># After downloading from Thistle Control Center
gunzip trh-*.gz
chmod +x trh-*
sudo mv trh-* /usr/local/bin/trh</code></pre>
          </div>
        </section>

        <section>
          <h3>Verify TRH Installation</h3>

          <div class="card">
            <h4>Test Installation</h4>
            <pre><code class="language-bash"># Verify installation
trh --help</code></pre>
          </div>

          <div class="alert alert-success">
            <strong>Expected Output:</strong> Help text showing available commands including <code>init</code>, <code>prepare</code>, <code>release</code>, and <code>gen-device-config</code>.
          </div>
        </section>

        <section>
          <h3>Install TUC (BeagleY-AI)</h3>

          <div class="card">
            <h4>Download Update Client for Device</h4>
            <div class="steps">
              <div class="step">Download TUC directly on BeagleY-AI device</div>
              <div class="step">Install system-wide on device</div>
              <div class="step">Verify installation</div>
            </div>
            <pre><code class="language-bash"># On BeagleY-AI via SSH - download directly on device
VER=1.6.0
curl -LO https://downloads.thistle.tech/embedded-client/$VER/tuc-$VER-aarch64-unknown-linux-musl.gz
gunzip tuc-$VER-aarch64-unknown-linux-musl.gz
chmod +x tuc-$VER-aarch64-unknown-linux-musl
sudo mv tuc-$VER-aarch64-unknown-linux-musl /usr/local/bin/tuc

# Verify installation
tuc --help | head -n 3</code></pre>
          </div>

          <div class="alert alert-info">
            <strong>Note:</strong> ARM64 (aarch64) binary is required for BeagleY-AI. Download from Thistle Control Center requires authenticated access.
          </div>
        </section>
      </section>

      <!-- Step 4: Initialize Project -->
      <section>
        <section>
          <h2>Step 4: Initialize Project</h2>
          <p class="lead">Configure signing keys and device enrollment</p>

          <div class="alert alert-warning">
            <strong>Security Note:</strong> Your Thistle API token provides access to your project. Treat it like a password and never commit it to version control.
          </div>
        </section>

        <section>
          <h3>Workstation Configuration</h3>

          <div class="card">
            <h4>Environment Setup</h4>
            <pre><code class="language-bash"># Set API token - replace with your actual token
export THISTLE_TOKEN="tht_proj_xxxxxxxxxxxxxx"

# Create working directory
mkdir ~/beagley-demo
cd ~/beagley-demo

# Initialize Thistle project with remote signing
trh --signing-method="remote" init --persist="/boot"</code></pre>
          </div>

          <div class="card">
            <h4>Generated Files</h4>
            <ul>
              <li><strong>config.json</strong> - Device enrollment configuration with enrollment token</li>
              <li><strong>manifest.json</strong> - Update package template</li>
            </ul>
            <p>Remote signing eliminates the need for local private keys, improving security.</p>
          </div>

          <div class="alert alert-success compact">
            <strong>Expected Output:</strong> Enrollment token, remote keypair generation, public key display, config file with <code>/boot</code> persist path.
          </div>
        </section>

        <section>
          <h3>Deploy Configuration</h3>

          <div class="card">
            <h4>Copy Configuration to Device</h4>
            <pre><code class="language-bash"># Copy configuration file to device
scp config.json debian@beagley-ota.local:/tmp/

# SSH to device and move to persistent location
ssh debian@beagley-ota.local
sudo mv /tmp/config.json /boot/tuc-config.json

# Verify file placement
ls -l /boot/tuc-config.json</code></pre>
          </div>

          <div class="alert alert-success">
            <strong>Success Criteria:</strong> Configuration file successfully copied and accessible at <code>/boot/tuc-config.json</code> on the BeagleY-AI.
          </div>
        </section>
      </section>

      <!-- Step 5: Create Update -->
      <section>
        <section>
          <h2>Step 5: Create Update Script</h2>
          <p class="lead">Develop LED blink demonstration</p>

          <div class="alert alert-info">
            <strong>Hardware Setup (Optional):</strong> Connect LED positive terminal to GPIO14 (Pin 8), negative terminal through resistor to GND (Pin 6). Script includes fallback for systems without hardware.
          </div>
        </section>

        <section>
          <h3>Create Update Content</h3>

          <div class="alert alert-info compact">
            <strong>Location:</strong> All commands in this section run on your workstation in the <code>~/beagley-demo</code> directory.
          </div>

          <div class="card">
            <h4>Prepare Directory Structure</h4>
            <pre><code class="language-bash"># Navigate to project directory and create files folder
cd ~/beagley-demo
mkdir -p files</code></pre>
          </div>
        </section>

        <section>
          <h3>Develop Blink Script</h3>

          <div class="card">
            <h4>LED Control Script with Fallback</h4>
            <pre><code class="language-bash">cat > files/blink.sh << 'EOF'
#!/bin/bash

CHIP="gpiochip2"
LINE=14
INTERVAL=2

echo "Blinking GPIO$LINE on $CHIP every $INTERVAL seconds. Press Ctrl+C to stop."

trap 'echo "Stopping..."; pkill -f "gpioset --chip $CHIP -z $LINE"; sudo gpioset --chip $CHIP -z $LINE=0; exit 0' INT

i=0
while true; do
    i=$((i+1))

    pkill -f "gpioset --chip $CHIP -z $LINE" 2>/dev/null
    sudo gpioset --chip $CHIP -z $LINE=1
    echo "Blink $i: ON"
    sleep $INTERVAL

    pkill -f "gpioset --chip $CHIP -z $LINE" 2>/dev/null
    sudo gpioset --chip $CHIP -z $LINE=0
    echo "Blink $i: OFF"
    sleep $INTERVAL
done
EOF

chmod +x files/blink.sh</code></pre>
          </div>
        </section>
      </section>

      <!-- Step 6: Package and Release -->
      <section>
        <section>
          <h2>Step 6: Sign and Release Update</h2>
          <p class="lead">Package files and deploy to cloud</p>

          <div class="alert alert-info">
            <strong>Process Overview:</strong> Thistle will compress files, generate checksums, create a signed manifest, and upload everything to secure cloud storage for distribution.
          </div>
        </section>

        <section>
          <h3>Package Update</h3>

          <div class="card">
            <h4>Prepare Signed Manifest</h4>
            <pre><code class="language-bash"># Package files with target installation path
trh --signing-method="remote" prepare \
  --target=./files \
  --file-base-path=/opt/demo</code></pre>
          </div>

          <div class="alert alert-success compact">
            <strong>Expected Output:</strong> Read manifest, processed files, manifest amended successfully.
          </div>
        </section>

        <section>
          <h3>Deploy to Cloud</h3>

          <div class="card">
            <h4>Upload Release</h4>
            <pre><code class="language-bash"># Upload to Thistle cloud infrastructure
trh --signing-method="remote" release</code></pre>
          </div>

          <div class="alert alert-success compact">
            <strong>Expected Output:</strong> Read manifest, uploaded assets, manifest uploaded successfully, compressed artifacts removed locally.
          </div>

          <div class="card">
            <h4>Security Features Applied</h4>
            <ul>
              <li>Files compressed with industry-standard zstd</li>
              <li>SHA256 checksums calculated for integrity</li>
              <li>Manifest cryptographically signed</li>
              <li>Distributed via secure CDN infrastructure</li>
            </ul>
          </div>
        </section>
      </section>

      <!-- Step 7: Deploy -->
      <section>
        <section>
          <h2>Step 7: Deploy to Device</h2>
          <p class="lead">Execute secure update process</p>

          <div class="alert alert-info">
            <strong>Process Overview:</strong> TUC will enroll the device, verify signatures, download files, and install them atomically with automatic rollback on failure.
          </div>
        </section>

        <section>
          <h3>Execute Update Client</h3>

          <div class="card">
            <h4>Run Thistle Update Client</h4>
            <pre><code class="language-bash"># On BeagleY-AI via SSH
sudo tuc -c /boot/tuc-config.json</code></pre>
          </div>

          <div class="alert alert-success">
            <strong>Expected Output:</strong>
            <pre><code>!! enrolling new device with server...
!! Thistle client starting with no bootloader set - file only mode
!! installing update 0 => 2
!! setting update status to Started
!! setting update status to Pass</code></pre>
            <p>Press <strong>Ctrl+C</strong> to stop the client after successful installation.</p>
          </div>
        </section>

        <section>
          <h3>Verify Installation</h3>

          <div class="card">
            <h4>Test Update Deployment</h4>
            <pre><code class="language-bash"># Verify file installation
ls /opt/demo/
cat /opt/demo/blink.sh

# Execute the update
sudo bash /opt/demo/blink.sh</code></pre>
          </div>

          <div class="alert alert-success compact">
            <strong>Success Indicators:</strong> File present at <code>/opt/demo/blink.sh</code>, LED blinks or simulation output, update status shows "Pass".
          </div>
        </section>

        <section>
          <h3>Optional: Auto-Start Service</h3>

          <div class="alert alert-info compact">
            <strong>Note:</strong> TUC doesn't run automatically on boot. For production deployments, create a systemd service.
          </div>

          <div class="card">
            <h4>Create Systemd Service</h4>
            <pre><code class="language-bash"># Create service file
sudo tee /etc/systemd/system/thistle-update.service > /dev/null << 'EOF'
[Unit]
Description=Thistle Update Client
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
ExecStart=/usr/local/bin/tuc -c /boot/tuc-config.json
Restart=always
RestartSec=30
RuntimeMaxSec=3600
User=root

[Install]
WantedBy=multi-user.target
EOF

# Create timer for delayed start (90 seconds after boot)
sudo tee /etc/systemd/system/thistle-update.timer > /dev/null << 'EOF'
[Unit]
Description=Thistle Update Client Timer
Requires=thistle-update.service

[Timer]
OnBootSec=90s
Unit=thistle-update.service

[Install]
WantedBy=timers.target
EOF

# Enable and start timer (will start service after 90s boot delay)
sudo systemctl daemon-reload
sudo systemctl enable thistle-update.timer
sudo systemctl start thistle-update.timer

# Check timer and service status
sudo systemctl status thistle-update.timer
sudo systemctl status thistle-update.service</code></pre>
          </div>
        </section>
      </section>

      <!-- Production Considerations -->
      <section>
        <section>
          <h2>Production Deployment</h2>
          <p class="lead">Scaling to enterprise environments</p>

          <div class="card compact">
            <h3>CI/CD Integration Example</h3>
            <pre><code class="language-yaml"># GitHub Actions Example
name: Deploy OTA Update
on:
  push:
    tags: ['v*']

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy Update
        env:
          THISTLE_TOKEN: ${{ secrets.THISTLE_TOKEN }}
        run: |
          trh --signing-method="remote" prepare --target=./release
          trh --signing-method="remote" release</code></pre>
          </div>

          <div class="card compact">
            <h3>Fleet Management Features</h3>
            <div style="font-size: 0.9rem; line-height: 1.3;">
              <strong>Device Groups:</strong> Staged rollout control ‚Ä¢
              <strong>Update Scheduling:</strong> Maintenance windows ‚Ä¢
              <strong>Rollback Triggers:</strong> Automatic failure detection ‚Ä¢
              <strong>Monitoring:</strong> Real-time deployment status
            </div>
          </div>
        </section>

        <section>
          <h3>Advanced Security Features</h3>

          <div class="grid grid-3">
            <div class="card">
              <h4>A/B System Updates</h4>
              <ul>
                <li>Dual root filesystem partitions</li>
                <li>Atomic system-wide updates</li>
                <li>Hardware-level rollback</li>
                <li>Zero-downtime updates</li>
              </ul>
            </div>

            <div class="card">
              <h4>Secure Boot Chain</h4>
              <ul>
                <li>Hardware root of trust</li>
                <li>Bootloader verification</li>
                <li>Kernel signature checking</li>
                <li>Application attestation</li>
              </ul>
            </div>

            <div class="card">
              <h4>Delta Updates</h4>
              <ul>
                <li>90-99% size reduction typical</li>
                <li>Binary-level differences only</li>
                <li>120MB ‚Üí 8MB example (93% reduction)</li>
                <li>5 hours ‚Üí 20 minutes deployment</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <h3>Real-World Deployments</h3>

          <div class="grid grid-3">
            <div class="card">
              <h4>Automotive Sector</h4>
              <p>Thousands of EV charging stations and vehicle systems receiving regular security updates</p>
              <span class="badge badge-success">Production Scale</span>
            </div>
            <div class="card">
              <h4>Industrial IoT</h4>
              <p>Large-scale sensor networks with automated firmware updates and remote management</p>
              <span class="badge badge-success">Mission Critical</span>
            </div>
            <div class="card">
              <h4>Smart Infrastructure</h4>
              <p>Connected devices in smart cities, buildings, and industrial automation systems</p>
              <span class="badge badge-success">Safety Critical</span>
            </div>
          </div>
        </section>
      </section>

      <!-- Troubleshooting -->
      <section>
        <section>
          <h2>Troubleshooting Guide</h2>

          <div class="grid grid-3">
            <div class="card">
              <h3>Update Not Available</h3>
              <h4>Diagnostic Steps</h4>
              <ul>
                <li>Verify device internet connectivity</li>
                <li>Confirm THISTLE_TOKEN environment variable</li>
                <li>Check that <code>trh release</code> completed successfully</li>
                <li>Verify device enrollment in web console</li>
              </ul>
            </div>

            <div class="card">
              <h3>Signature Verification Failed</h3>
              <h4>Common Causes</h4>
              <ul>
                <li>Clock skew between device and server</li>
                <li>Corrupted configuration file</li>
                <li>Network interference during download</li>
                <li>Expired authentication tokens</li>
              </ul>
            </div>

            <div class="card">
              <h3>Application Errors</h3>
              <h4>Debug Commands</h4>
              <ul>
                <li><code>tuc -v</code> for verbose logging</li>
                <li><code>journalctl -f</code> for system logs</li>
                <li>Check file permissions and paths</li>
                <li>Verify GPIO hardware connections</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <h3>WiFi Connection Issues</h3>
          <p class="lead">If WiFi isn't connecting, use USB connection to diagnose and fix</p>

          <div class="alert alert-info">
            <strong>Fallback Strategy:</strong> Connect via USB cable and SSH to <code>beagley-ota.local</code> or <code>192.168.7.2</code> to troubleshoot WiFi connectivity.
          </div>

          <div class="card">
            <h4>Check Network Interfaces</h4>
            <pre><code class="language-bash"># Check all network interfaces
ip a

# Look for wlan0 interface status
# Should see: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; when working</code></pre>
          </div>

          <div class="card">
            <h4>Bring Up WiFi Interface</h4>
            <pre><code class="language-bash"># Enable the WiFi interface
sudo ip link set wlan0 up

# Scan for available networks
sudo iwlist wlan0 scan | grep ESSID</code></pre>
          </div>
        </section>

        <section>
          <h3>Manual WiFi Configuration</h3>

          <div class="grid grid-2">
            <div class="card">
              <h4>Create WPA Supplicant Config</h4>
              <pre><code class="language-bash"># Create/edit WiFi configuration
sudo nano /etc/wpa_supplicant/wpa_supplicant-wlan0.conf

# Add network configuration:
network={
    ssid="Your-WiFi-Name"
    psk="your-wifi-password"
}</code></pre>
            </div>

            <div class="card">
              <h4>Start WiFi Connection</h4>
              <pre><code class="language-bash"># Start wpa_supplicant
sudo wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant-wlan0.conf

# Request IP address
sudo dhclient wlan0

# Verify connection
ip a | grep wlan0</code></pre>
            </div>
          </div>

          <div class="alert alert-success">
            <strong>Success Indicators:</strong>
            <ul>
              <li><code>wlan0</code> shows <code>UP,LOWER_UP</code> state</li>
              <li>IP address assigned (e.g., <code>192.168.0.89/24</code>)</li>
              <li>Can ping external addresses: <code>ping -c 3 8.8.8.8</code></li>
            </ul>
          </div>

          <div class="alert alert-info">
            <strong>Pro Tip:</strong> Once WiFi is working, you can disconnect USB and continue the workshop over WiFi using the assigned IP address or <code>beagley-ota.local</code>.
          </div>
        </section>

        <section>
          <h3>Additional Troubleshooting</h3>

          <div class="alert alert-info">
            <strong>Support Resources:</strong> Use <code>trh fetch-current</code> to inspect deployed manifests and verify expected file contents and metadata.
          </div>
        </section>
      </section>

      <!-- Summary -->
      <section>
        <section>
          <h2>Workshop Summary</h2>
          <p class="lead">Professional OTA infrastructure implemented</p>

          <div class="grid grid-2">
            <div class="card">
              <h3>Security Achievements</h3>
              <ul>
                <li>Cryptographic signing with cloud-based KMS</li>
                <li>Device authentication and enrollment</li>
                <li>Signature verification before installation</li>
                <li>Atomic file operations with rollback safety</li>
              </ul>
            </div>

            <div class="card">
              <h3>Production Capabilities</h3>
              <ul>
                <li>Cloud-based update distribution</li>
                <li>Fleet management and monitoring</li>
                <li>CI/CD integration ready</li>
                <li>Scalable to thousands of devices</li>
              </ul>
            </div>
          </div>

          <div class="alert alert-success">
            <strong>Key Insight:</strong> You have implemented the same security model used by smartphones, automotive systems, and industrial IoT deployments. The LED blink demonstrates the complete secure update pipeline.
          </div>
        </section>

        <section>
          <h3>Next Steps</h3>

          <div class="card">
            <h4>Advanced OTA Features</h4>
            <ul>
              <li><strong>Explore A/B Updates:</strong> Full system rollback with dual partitions</li>
              <li><strong>Implement Secure Boot:</strong> Hardware-verified boot chain</li>
              <li><strong>CI/CD Integration:</strong> Automate releases from build pipeline</li>
              <li><strong>Device Groups:</strong> Manage staged rollouts across fleet</li>
            </ul>
          </div>

          <div class="alert alert-info">
            <strong>Recommended Learning Path:</strong> Start with CI/CD integration using your existing file update knowledge, then explore A/B updates for critical systems, and finally implement Secure Boot for maximum security.
          </div>
        </section>
      </section>

      <!-- Thank You -->
      <section class="title-slide">
        <h1>Workshop Complete</h1>
        <p class="subtitle">Professional OTA Updates Implemented</p>

        <div class="alert alert-success compact" style="max-width: 800px; margin: 1rem auto;">
          <strong>Skills Acquired:</strong> Cryptographic signing, device authentication, secure deployment, fleet management, production security practices
        </div>

        <div class="logos">
          <span class="logo">BeagleBoard.org</span>
          <span class="logo">Thistle Technologies</span>
        </div>

        <p style="margin-top: 1rem; font-size: 1rem; line-height: 1.4;">
          <strong>Documentation:</strong> <a href="https://docs.thistle.tech" target="_blank">docs.thistle.tech</a> ‚Ä¢ <a href="https://docs.beagleboard.org" target="_blank">docs.beagleboard.org</a><br>
          <strong>Community:</strong> <a href="https://discord.gg/beagleboard" target="_blank">BeagleBoard Discord</a> ‚Ä¢ Thistle Support Portal<br>
          <strong>Advanced Topics:</strong> Secure Boot OTA Workshop
        </p>

        <div class="alert alert-info compact" style="max-width: 600px; margin: 1rem auto;">
          <strong>Navigation:</strong> Use arrow keys or press 'S' for detailed speaker notes throughout any section.
        </div>
      </section>

    </div>
  </div>

  <!-- Reveal.js and Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/notes/notes.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/search/search.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/zoom/zoom.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/highlight/highlight.js"></script>
  <script src="../../framework/codelab-framework.js"></script>

  <script>
    // Initialize Reveal.js with professional settings
    Reveal.initialize({
      hash: true,
      controls: true,
      progress: true,
      center: false,
      slideNumber: 'c/t',
      width: 1280,
      height: 720,
      margin: 0.02,
      plugins: [RevealNotes, RevealSearch, RevealZoom, RevealHighlight],

      // Professional navigation
      keyboard: {
        67: () => { // 'C' key for copy
          const currentSlide = Reveal.getCurrentSlide();
          const firstCodeBlock = currentSlide.querySelector('pre code');
          if (firstCodeBlock && navigator.clipboard) {
            navigator.clipboard.writeText(firstCodeBlock.textContent).then(() => {
              console.log('Code copied to clipboard');
            });
          }
        }
      },

      // Smooth transitions
      transition: 'slide',
      transitionSpeed: 'default',
      backgroundTransition: 'fade'
    });

    // Educational enhancements
    Reveal.addEventListener('ready', () => {
      console.log('üéì Thistle Professional Codelab Ready');
      console.log('‚å®Ô∏è  Keyboard: C=copy, S=speaker notes, /=search, F=fullscreen');
      console.log('üìñ Navigate: ‚Üê‚Üí for slides, ‚Üì‚Üë for sub-slides');
    });

    // Track learning progress
    Reveal.addEventListener('slidechanged', (event) => {
      const slideTitle = event.currentSlide.querySelector('h1, h2, h3');
      if (slideTitle) {
        console.log(`üìç Current: ${slideTitle.textContent}`);
      }
    });
  </script>
</body>
</html>